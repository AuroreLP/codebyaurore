{% extends 'base.html.twig' %}

{% block title "Article: " ~ article.title %}

{% block body %}

<article>

    <h2>{{ article.title }}</h2>
    <h3>{{ article.category.name }}</h3>

    <p>{{ article.content | nl2br }}</p>

    {% if article.publishedAt %}
        <p>Article publié le {{ article.publishedAt | date("d.m.y") }}</p>
    {% else  %}
        <p>{{ article.status }}</p>
    {% endif  %}

</article>

<div>
    <!-- affichage des commentaires -->
    <h3>Commentaires</h3>

    {% for existingComment in article.comments %}
        <div>
            <p>{{ existingComment.comment }}</p>
            <small>Posté le {{ existingComment.publishedAt|date('d/m/Y H:i') }} par {{ existingComment.username}}</small>
            
            <!-- Afficher le formulaire de modification -->
            <a class="button--dark-green" href="{{ path('comment.edit', {id: existingComment.id}) }}">Modifier</a>

            <!-- Afficher le formulaire de suppression -->
            <form action="{{ path('comment.delete', {id: existingComment.id}) }}" method="POST">
                {{ form_row(delete_forms[existingComment.id]._token) }}
                <button class="button--delete" type="submit">Supprimer</button>
            </form>
        </div>
        {% else %}
        <p>Aucun commentaire pour cet article.</p>
    {% endfor %}
    
    <h3>Ajouter un commentaire</h3>
    <form method="post" action="{{ path('comment.new', { 'slug': article.slug }) }}">
        {{ form_start(form) }}
            {{ form_row(form.username) }}
            {{ form_row(form.email) }}
            {{ form_row(form.comment) }}
            <button type="submit">Envoyer</button>
        {{ form_end(form) }}
    </form>

</div>

{% endblock %}